{% extends "main/base.html" %}
{% load crispy_forms_tags %}

{% block title %}
All Menus
{% endblock title%}

{% block content %}
<div class="jumbotron jumbotron-fluid">
    <div class="col-md-10">
        {% if user.is_authenticated %}
            <h1> Hi {{ user.username }}! </h1>
            <p class="text-right"><a class="btn btn-danger" href="{% url 'logout' %}">Logout</a> </p>
        {% else %}
            <p>You are not logged in</p>
            <a href="{% url 'login' %}">Log In</a>
        {% endif %}
    </div>
    <div class="col-md-10">
        <h1> All Menus </h1>
        <table class="table table-hover">
            <thead>
            <tr>
                <th scope="col">Menu_ID</th>
                <th scope="col">Menu_Name</th>
                <th scope="col">Menu_Date</th>
                {% if user.is_authenticated %}
                    <th scope="col">Choose Options</th>
                {% endif %}

                {% if user.is_staff and user.is_authenticated %}
                    <th scope="col">Edit Menu</th>
                {% endif %}
            </tr>
            </thead>
            <tbody>
                {% for menu in menus %}
                    <tr>
                        <th scope="row">{{menu.menu_id}}</th>
                        <td>{{menu.menu_name}}</td>
                        <td>{{menu.menu_date}}</td>
                        {% if user.is_authenticated %}
                            <th scope="row"><a href="#"><span id="choose_options_{{ menu.menu_id }}_{{ user.id }}" class="fas fa-sign-in-alt" style="color: blue" onclick="choose_options(this.id);"></span></a></th>
                        {% endif %}

                        {% if user.is_staff and user.is_authenticated %}
                            <th scope="row"><a href="#"><span id="edit_menu_{{ menu.menu_id }}_{{ user.id }}" class="fas fa-edit" style="color: orange" onclick="edit_menu(this.id);"></span></a></th>
                        {% endif %}
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    {% if user.is_authenticated and user.is_staff %}
        <a href="/create_menu" class="btn btn-success" name="save">Create</a>
    {% endif %}
</div>

<script>

    function extract_id(menu_id_str, splitter) {
        const ids = menu_id_str.split(splitter)[1];
        const menu_id, employee_id = ids.split('_');
        return [menu_id, employee_id];

    }

    function choose_options(menu_id_str) {
        const ids = extract_id(menu_id_str, 'choose_options_');
        window.location = '/make_selection/'+ids[0]+'/'+ids[1];
    }

    function edit_menu(menu_id_str) {
        const menu_id = extract_id(menu_id_str, 'edit_menu_');
        window.location = '/edit_menu/'+ids[0]+'/'+ids[1];
    }


</script>
{% endblock content %}